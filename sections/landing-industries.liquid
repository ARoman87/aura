<div class="md:py-20 py-10" id="industries-section">
  <div class="container">
    <div class="flex justify-center">
      <h2 class="title-main">[ Industries We Serve ]</h2>
    </div>

    <!-- Scroll Stack Container -->
    <div class="pb-40 relative md:block hidden" id="scroll-stack-container">
      <div class="sticky top-10 h-[700px] flex items-center justify-center">
        <div class="relative w-[670px] h-[600px]" id="stack-wrapper">
          <!-- Image 1 - Your original styling -->
          <div
            class="stack-item absolute w-full h-full transition-all duration-700 ease-in-out"
            data-index="0"
            style="transform: translate(0, 0); z-index: 20;"
          >
            <div
              class="h-[600px] w-[500px] lg:w-[670px] overflow-hidden bg-cover bg-center flex items-end"
              style="background-image: url({{'industry1.webp' | asset_url}});"
            >
              <a href="/">
                <div class="h-[150px] w-[400px] relative hover:scale-105 transition-all duration-300 bg-primary text-black p-6 flex flex-col gap-6">
                  <div class="bg-white h-12 w-12 absolute top-0 text-2xl right-0 flex items-center justify-center">
                    <i class="fa-regular fa-arrow-up-right"></i>
                  </div>
                  <h3 class="title-main text-xl">Aurora Spark For Real Estate</h3>
                  <p class="text-sm">Lead funnels, local SEO, listing promotions</p>
                </div>
              </a>
            </div>
          </div>

          <!-- Image 2 - Your original styling -->
          <div
            class="stack-item absolute w-full h-full transition-all duration-700 ease-[cubic-bezier(0.22,1,0.36,1)"
            data-index="1"
            style="transform: translate(20px, 20px); z-index: 19;"
          >
            <div
              class="h-[600px] w-full md:w-[500px] lg:w-[670px] overflow-hidden bg-cover bg-center flex items-end"
              style="background-image: url({{'industry2.webp' | asset_url}});"
            >
              <a href="/">
                <div class="h-[150px] w-[400px] relative hover:scale-105 transition-all duration-300 bg-primary text-black p-6 flex flex-col gap-6">
                  <div class="bg-white h-12 w-12 absolute top-0 text-2xl right-0 flex items-center justify-center">
                    <i class="fa-regular fa-arrow-up-right"></i>
                  </div>
                  <h3 class="title-main text-xl">Aurora Spark For Real Estate</h3>
                  <p class="text-sm">Lead funnels, local SEO, listing promotions</p>
                </div>
              </a>
            </div>
          </div>
          <!-- Image 3 - Your original styling -->
          <!--
            <div
              class="stack-item absolute w-full h-full transition-all duration-700 ease-in-out"
              data-index="2"
              style="transform: translate(40px, 40px); z-index: 18;"
            >
              <div
                class="h-[600px] w-[500px] lg:w-[670px] overflow-hidden bg-cover bg-center flex items-end"
                style="background-image: url({{'industry1.webp' | asset_url}});"
              >
                <a href="/">
                  <div class="h-[150px] w-[400px] relative hover:scale-105 transition-all duration-300 bg-primary text-black p-6 flex flex-col gap-6">
                    <div class="bg-white h-12 w-12 absolute top-0 text-2xl right-0 flex items-center justify-center">
                      <i class="fa-regular fa-arrow-up-right"></i>
                    </div>
                    <h3 class="title-main text-xl">Aurora Spark For Real Estate</h3>
                    <p class="text-sm">Lead funnels, local SEO, listing promotions</p>
                  </div>
                </a>
              </div>
            </div>
          -->
        </div>
      </div>
      <div class="md:flex justify-end gap-4 md:mt-0 mt-6 hidden">
        <span
          id="prevBtn-2"
          class="md:h-16 w-12 h-12 md:w-16 flex items-center justify-center bg-white/20 text-xl md:text-3xl hover:bg-white/30 transition-colors duration-300 cursor-pointer"
          ><i class="fa-regular fa-arrow-left"></i
        ></span>
        <span
          id="nextBtn-2"
          class="md:h-16 w-12 h-12 md:w-16 flex items-center justify-center bg-white/20 text-xl md:text-3xl hover:bg-white/30 transition-colors duration-300 cursor-pointer"
          ><i class="fa-regular fa-arrow-right"></i
        ></span>
      </div>
    </div>
    <div class="md:hidden flex flex-col gap-4 mt-10">
      <div
        class="h-[400px] w-full overflow-hidden bg-cover bg-center flex items-end"
        style="background-image: url({{'industry1.webp' | asset_url}});"
      >
        <a href="/">
          <div class="h-[100px] w-[300px] relative hover:scale-105 transition-all duration-300 bg-primary text-black p-4 flex flex-col gap-2">
            <div class="bg-white h-8 w-8 absolute top-0  right-0 flex items-center justify-center">
              <i class="fa-regular fa-arrow-up-right"></i>
            </div>
            <h3 class="title-main">Aurora Spark For Real Estate</h3>
            <p class="text-xs">Lead funnels, local SEO, listing promotions</p>
          </div>
        </a>
      </div>
      <div
        class="h-[400px] w-full overflow-hidden bg-cover bg-center flex items-end"
        style="background-image: url({{'industry2.webp' | asset_url}});"
      >
        <a href="/">
          <div class="h-[100px] w-[300px] relative hover:scale-105 transition-all duration-300 bg-primary text-black p-4 flex flex-col gap-2">
            <div class="bg-white h-8 w-8 absolute top-0  right-0 flex items-center justify-center">
              <i class="fa-regular fa-arrow-up-right"></i>
            </div>
            <h3 class="title-main">Aurora Spark For Real Estate</h3>
            <p class="text-xs">Lead funnels, local SEO, listing promotions</p>
          </div>
        </a>
      </div>
    </div>
  </div>
</div>

<script>
  (function () {
    function setupStack(root = document) {
      const stackItems = Array.from(root.querySelectorAll('#scroll-stack-container .stack-item'));
      const prevBtn = root.getElementById('prevBtn-2');
      const nextBtn = root.getElementById('nextBtn-2');
      if (!stackItems.length || !prevBtn || !nextBtn) return;

      if (prevBtn.__bound || nextBtn.__bound) return;
      prevBtn.__bound = nextBtn.__bound = true;

      const N = stackItems.length;
      const SPACING = 40;
      const MAX_FRONT_Z = 999;
      const TRANSITION_MS = 700; // match your Tailwind duration-700

      // Force clean indices 0..N-1 and clear any inline transforms
      stackItems.forEach((el, i) => {
        el.dataset.index = String(i);
        el.style.transform = '';
        el.style.zIndex = '';
        el.style.backfaceVisibility = 'hidden';
        el.style.willChange = 'transform';
      });

      let activeIndex = 0;
      layout(activeIndex, null);

      prevBtn.addEventListener('click', () => {
        const next = (activeIndex - 1 + N) % N;
        layout(next, activeIndex);
        activeIndex = next;
      });

      nextBtn.addEventListener('click', () => {
        const next = (activeIndex + 1) % N;
        layout(next, activeIndex);
        activeIndex = next;
      });

      root.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          const next = (activeIndex - 1 + N) % N;
          layout(next, activeIndex);
          activeIndex = next;
        } else if (e.key === 'ArrowRight') {
          const next = (activeIndex + 1) % N;
          layout(next, activeIndex);
          activeIndex = next;
        }
      });

      function layout(nextActive, prevActive) {
        stackItems.forEach((el) => {
          const i = parseInt(el.dataset.index, 10);
          const rank = (i - nextActive + N) % N; // 0=front, 1,2,... behind
          const x = SPACING * rank;
          const y = SPACING * rank;

          const scale = rank === 0 ? 1 : 0.995 - (rank - 1) * 0.005;
          const opacity = rank === 0 ? 1 : 0.98 - (rank - 1) * 0.02;

          // z-index strategy:
          // - Incoming front gets MAX_FRONT_Z
          // - Previous front holds MAX_FRONT_Z-1 during motion, then drops after transition
          // - Others are below, ordered by rank
          if (i === nextActive) {
            el.style.zIndex = String(MAX_FRONT_Z);
          } else if (prevActive != null && i === prevActive) {
            el.style.zIndex = String(MAX_FRONT_Z - 1);
          } else {
            el.style.zIndex = String(200 - rank);
          }

          // Promote animation on incoming
          if (prevActive != null && i === nextActive) {
            // force reflow
            el.getBoundingClientRect();
            el.style.transform = `translate3d(${x}px, ${y}px, 0) scale(${scale + 0.02})`;
            el.style.filter = 'drop-shadow(0 12px 24px rgba(0,0,0,0.35))';
            el.style.opacity = String(opacity);
            setTimeout(() => {
              el.style.transform = `translate3d(${x}px, ${y}px, 0) scale(${scale})`;
            }, 120);
          } else {
            el.style.transform = `translate3d(${x}px, ${y}px, 0) scale(${scale})`;
            el.style.filter = rank === 0 ? 'drop-shadow(0 12px 24px rgba(0,0,0,0.35))' : '';
            el.style.opacity = String(opacity);
          }
        });

        // After the movement completes, drop the previous card's z-index to its rank level.
        if (prevActive != null) {
          const prevEl = stackItems[prevActive];
          const rankPrev = (prevActive - nextActive + N) % N;
          setTimeout(() => {
            if (!prevEl) return;
            prevEl.style.zIndex = String(200 - rankPrev);
          }, TRANSITION_MS);
        }
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', () => setupStack());
    } else {
      setupStack();
    }
    document.addEventListener('shopify:section:load', (e) => setupStack(e.target));
  })();
</script>
